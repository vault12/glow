!function t(e,n,r){function o(s,u){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(i)return i(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return o(n||t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(t){return"function"==typeof t}function i(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function u(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!i(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,i,c,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(n=this._events[t],u(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(s(n))for(i=Array.prototype.slice.call(arguments,1),r=(a=n.slice()).length,c=0;c<r;c++)a[c].apply(this,i);return!0},r.prototype.addListener=function(t,e){var n;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(n=u(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!o(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,i,u;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],i=n.length,r=-1,n===e||o(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(u=i;u-- >0;)if(n[u]===e||n[u].listener&&n[u].listener===e){r=u;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],o(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,n){var r;r=function(){function t(){}return t._NONCE_TAG="__nc",t._SKEY_TAG="storage_key",t._DEF_ROOT=".v1.stor.vlt12",t.RELAY_TOKEN_LEN=32,t.RELAY_TOKEN_B64=44,t.RELAY_TOKEN_TIMEOUT=3e5,t.RELAY_SESSION_TIMEOUT=9e5,t.RELAY_AJAX_TIMEOUT=5e3,t.RELAY_RETRY_REQUEST_ATTEMPTS=15,t.RELAY_BLOCKING_TIME=36e5,t}(),e.exports=r},{}],3:[function(t,e,n){var r,o,i,s,u;r=t("config"),i=t("keys"),s=t("nacl"),u=t("utils"),o=function(){function t(){}return t.prototype._storageDriver=null,t.prototype.tag=function(t){return t&&t+this.root},t.new=function(e,n){var o;return null==e&&(e=null),null==n&&(n=null),o=new t,o.storageKey=e,o.root=n?"."+n+r._DEF_ROOT:r._DEF_ROOT,o.storageKey?u.resolve(o):o._loadKey().then(function(){return o.storageKey?o:o.newKey().then(function(){return o})})},t.prototype._saveKey=function(){return this._set(r._SKEY_TAG,this.storageKey.toString())},t.prototype._loadKey=function(){return this._get(r._SKEY_TAG).then(function(t){return function(e){if(e)return t.setKey(i.fromString(e))}}(this))},t.prototype.selfDestruct=function(t){return u.ensure(t),this._localRemove(this.tag(r._SKEY_TAG))},t.prototype.setKey=function(t){return this.storageKey=t,this._saveKey()},t.prototype.newKey=function(){return s.makeSecretKey().then(function(t){return function(e){return t.setKey(e)}}(this))},t.prototype.save=function(t,e){return u.ensure(t),e=JSON.stringify(e),s.use().encode_utf8(e).then(function(e){return function(n){return s.use().crypto_secretbox_random_nonce().then(function(o){return s.use().crypto_secretbox(n,o,e.storageKey.key).then(function(n){return e._multiSet(t,n.toBase64(),r._NONCE_TAG+"."+t,o.toBase64()).then(function(){return!0})})})}}(this))},t.prototype.get=function(t){return this._get(t).then(function(e){return function(n){return n?e._get(r._NONCE_TAG+"."+t).then(function(t){return t?s.use().crypto_secretbox_open(n.fromBase64(),t.fromBase64(),e.storageKey.key).then(function(t){return s.use().decode_utf8(t).then(function(t){return JSON.parse(t)})}):null}):null}}(this))},t.prototype.remove=function(t){return this._localRemove(this.tag(t)).then(function(e){return function(){return e._localRemove(e.tag(r._NONCE_TAG+"."+t)).then(function(){return!0})}}(this))},t.prototype._get=function(t){return this._localGet(this.tag(t))},t.prototype._set=function(t,e){return u.ensure(t),this._localSet(this.tag(t),e).then(function(){return e})},t.prototype._multiSet=function(t,e,n,r){return u.ensure(t,n),this._storage().multiSet?this._localMultiSet([this.tag(t),e,this.tag(n),r]):this._set(t,e).then(function(t){return function(){return t._set(n,r)}}(this))},t.prototype._localGet=function(t){return this._storage().get(t)},t.prototype._localSet=function(t,e){return this._storage().set(t,e)},t.prototype._localMultiSet=function(t){return this._storage().multiSet(t)},t.prototype._localRemove=function(t){return this._storage().remove(t)},t.prototype._storage=function(){return t._storageDriver},t.startStorageSystem=function(t){return u.ensure(t),this._storageDriver=t},t}(),e.exports=o},{config:2,keys:8,nacl:12,utils:16}],4:[function(t,e,n){var r,o;o=t("utils"),r=function(){function e(e,n){null==e&&(e=null),this.HEAP_SIZE=null!=n?n:Math.pow(2,26),this.js_nacl=e||("undefined"!=typeof nacl_factory&&null!==nacl_factory?nacl_factory:void 0)||t("js-nacl"),this.load()}return e.prototype._instance=null,e.prototype._unloadTimer=null,e.prototype.use=function(){if(!this._instance)throw new Error("js-nacl is not loaded");return this._instance},e.prototype.load=function(){return nacl_factory.instantiate(function(e){return function(n){return e._instance=n,e.crypto_secretbox_KEYBYTES=e.use().crypto_secretbox_KEYBYTES,t("nacl").API.forEach(function(t){return e[t]=function(){var n,r;r=e.use();try{return o.resolve(r[t].apply(r,arguments))}catch(t){return n=t,o.reject(n)}}})}}(this),{requested_total_memory:this.HEAP_SIZE})},e.prototype.unload=function(){return this._instance=null,delete this._instance},e}(),e.exports=r,window.__CRYPTO_DEBUG&&(window.JsNaclDriver=r)},{"js-nacl":void 0,nacl:12,utils:16}],5:[function(t,e,n){var r,o;o=t("utils"),r=function(){return function(e,n,r){var i,s,u,c,a,l;null==e&&(e="./build/js_nacl_worker.js"),null==n&&(n="../node_modules/js-nacl/lib/nacl_factory.js"),null==r&&(r=Math.pow(2,26)),a={random_bytes:32,crypto_box_keypair:32,crypto_box_random_nonce:24,crypto_secretbox_random_nonce:24},s=!1,i=[],c={},l=new Worker(e),this.crypto_secretbox_KEYBYTES=32,t("nacl").API.forEach(function(t){return function(e){var n;return n=[],c[e]=n,i.push(e),t[e]=function(){var t,r,i,u;return r=o.promise(function(t,e){return n.push({resolve:t,reject:e})}),t=Array.prototype.slice.call(arguments),i=[],u=null,s||a[e]&&(u=new Uint8Array(32),crypto.getRandomValues(u)),l.postMessage({cmd:e,args:t,rnd:u},i),r}}}(this)),u=function(t){var e;return e=c[t.data.cmd],t.data.error?e.shift().reject(new Error(t.data.message)):e.shift().resolve(t.data.res)},l.onmessage=function(t){if("init"!==t.data.cmd)throw new Error;return s=t.data.hasCrypto,console.log("js nacl web worker initialized; hasCrypto: "+s),l.onmessage=u},l.postMessage({cmd:"init",naclPath:n,heapSize:r,api:i})}}(),e.exports=r,window.__CRYPTO_DEBUG&&(window.JsNaclDriver=r)},{nacl:12,utils:16}],6:[function(t,e,n){var r,o;o=t("nacl"),r=function(){function t(){}return t.prototype.lastKey=null,t.prototype.confirmedKey=null,t.prototype.nextKey=null,t.prototype._roles=["lastKey","confirmedKey","nextKey"],t.new=function(e,n,r){var o,i;return this.id=e,this.keyRing=n,null==r&&(r=null),Utils.ensure(this.id,this.keyRing),i=new t,o=this._roles.map(function(t){return i.keyRing.getKey(i.keyTag(t)).then(function(e){return i[t]=e})}),Utils.all(o).then(function(){return r?i.startRatchet(r).then(function(){return i}):i})},t.prototype.keyTag=function(t){return t+"_"+this.id},t.prototype.storeKey=function(t){return this.keyRing.saveKey(this.keyTag(t),this[t])},t.prototype.startRatchet=function(t){var e;return e=["confirmedKey","lastKey"].map(function(e){return function(n){if(!e[n])return e[n]=t,e.storeKey(n)}}(this)),Utils.all(e).then(function(t){return function(){if(!t.nextKey)return o.makeKeyPair().then(function(e){return t.nextKey=e,t.storeKey("nextKey")})}}(this))},t.prototype.pushKey=function(t){return this.lastKey=this.confirmedKey,this.confirmedKey=this.nextKey,this.nextKey=t,Utils.all(this._roles.map(function(t){return function(e){return t.storeKey(e)}}(this)))},t.prototype.confKey=function(t){return this.confirmedKey&&this.confirmedKey.equal(t)?Utils.resolve(!1):(this.lastKey=this.confirmedKey,this.confirmedKey=t,Utils.all(["lastKey","confirmedKey"].map(function(t){return function(e){return t.storeKey(e)}}(this))).then(function(){return!0}))},t.prototype.curKey=function(){return this.confirmedKey?this.confirmedKey:this.lastKey},t.prototype.h2LastKey=function(){return o.h2(this.lastKey.boxPk)},t.prototype.h2ConfirmedKey=function(){return o.h2(this.confirmedKey.boxPk)},t.prototype.h2NextKey=function(){return o.h2(this.nextKey.boxPk)},t.prototype.keyByHash=function(t){return Utils.serial(this._roles,function(e){return function(n){return o.h2(e[s].boxPk).then(function(n){if(n===t)return e[s]})}}(this))},t.prototype.isNextKeyHash=function(t){return this.h2NextKey().then(function(e){return e.equal(t)})},t.prototype.toStr=function(){return JSON.stringify(this).toBase64()},t.prototype.fromStr=function(t){return Utils.extend(this,JSON.parse(t.fromBase64()))},t.prototype.selfDestruct=function(t){return Utils.ensure(t),Utils.all(this._roles.map(function(t){return function(e){return t.keyRing.deleteKey(t.keyTag(e))}}(this)))},t}(),e.exports=r,window.__CRYPTO_DEBUG&&(window.KeyRatchet=r)},{nacl:12}],7:[function(t,e,n){var r,o,i,s,u,c,a,l,h=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;r=t("config"),o=t("crypto_storage"),u=t("keys"),c=t("nacl"),a=t("utils"),i=t("events").EventEmitter,l=a.ensure,s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return h(e,i),e.new=function(t,n){var r,i,s;return null==n&&(n=null),i=new e,n?(r=u.fromString(n),s=o.new(r,t).then(function(t){return i.storage=t})):s=o.new(null,t).then(function(t){return i.storage=t}),s.then(function(){return i._ensureKeys().then(function(){return i})})},e.UNIQ_TAG="__::commKey::__",e.fromBackup=function(t,n){var r,o,i;return l(n),r=JSON.parse(n),i=r[this.UNIQ_TAG],l(i),delete r[this.UNIQ_TAG],o=function(t,e){return t.then(function(){var t,n,o;return o=function(){var o;o=[];for(n in r)t=r[n],o.push(e.addGuest(n,r[n]));return o}(),a.all(o)})},e.new(t).then(function(t){var e;return e=t.commFromSecKey(i.fromBase64()),[e,t]}).then(function(t){var e,n;return n=t[0],e=t[1],o(n,e).then(function(){return e})})},e.prototype._ensureKeys=function(){return this._loadCommKey().then(function(t){return function(){return t._loadGuestKeys()}}(this))},e.prototype._loadCommKey=function(){return this.getKey("comm_key").then(function(t){return function(e){return t.commKey=e,t.commKey?c.h2(t.commKey.boxPk).then(function(e){return t.hpk=e,t.commKey}):c.makeKeyPair().then(function(e){return t.commKey=e,c.h2(t.commKey.boxPk).then(function(e){return t.hpk=e}).then(function(){return t.saveKey("comm_key",t.commKey),t.commKey})})}}(this))},e.prototype.getNumberOfGuests=function(){return Object.keys(this.guestKeys||{}).length},e.prototype._loadGuestKeys=function(){return this.storage.get("guest_registry").then(function(t){return function(e){return t.guestKeys=e||{},t.guestKeyTimeouts={}}}(this))},e.prototype.commFromSeed=function(t){return c.encode_utf8(t).then(function(t){return function(e){return c.fromSeed(e).then(function(e){return t.commKey=e,c.h2(t.commKey.boxPk).then(function(e){return t.hpk=e}).then(function(){return t.storage.save("comm_key",t.commKey.toString()),t.commKey})})}}(this))},e.prototype.commFromSecKey=function(t){return c.fromSecretKey(t).then(function(t){return function(e){return t.commKey=e,c.h2(t.commKey.boxPk).then(function(e){return t.hpk=e}).then(function(){return t.storage.save("comm_key",t.commKey.toString()),t.commKey})}}(this))},e.prototype.tagByHpk=function(t){var e,n,r;n=this.guestKeys;for(e in n)if(f.call(n,e)&&(r=n[e],t===r.hpk))return e;return null},e.prototype.getMasterKey=function(){return this.storage.storageKey.key2str("key")},e.prototype.getPubCommKey=function(){return this.commKey.strPubKey()},e.prototype.saveKey=function(t,e){return this.storage.save(t,e.toString()).then(function(){return e})},e.prototype.getKey=function(t){return this.storage.get(t).then(function(t){return t?u.fromString(t):null})},e.prototype.deleteKey=function(t){return this.storage.remove(t)},e.prototype.addGuest=function(t,e){return l(t,e),e=e.trimLines(),this._addGuestRecord(t,e).then(function(e){return function(n){return e._saveNewGuest(t,n).then(function(){return n.hpk})}}(this))},e.prototype._addGuestRecord=function(t,e){return l(t,e),c.h2(e.fromBase64()).then(function(n){return function(r){return n.guestKeys[t]={pk:e,hpk:r.toBase64(),temp:!1}}}(this))},e.prototype._saveNewGuest=function(t,e){return l(t,e),this.storage.save("guest_registry",this.guestKeys)},e.prototype.timeToGuestExpiration=function(t){var e;return l(t),(e=this.guestKeyTimeouts[t])?Math.max(r.RELAY_SESSION_TIMEOUT-(Date.now()-e.startTime),0):0},e.prototype.addTempGuest=function(t,e){return l(t,e),e=e.trimLines(),c.h2(e.fromBase64()).then(function(n){return function(o){return n.guestKeys[t]={pk:e,hpk:o.toBase64(),temp:!0},n.guestKeyTimeouts[t]&&clearTimeout(n.guestKeyTimeouts[t].timeoutId),n.guestKeyTimeouts[t]={timeoutId:a.delay(r.RELAY_SESSION_TIMEOUT,function(){return delete n.guestKeys[t],delete n.guestKeyTimeouts[t],n.emit("tmpguesttimeout",t)}),startTime:Date.now()}}}(this))},e.prototype.removeGuest=function(t){return l(t),this.guestKeys[t]?(delete this.guestKeys[t],this.storage.save("guest_registry",this.guestKeys)):a.resolve()},e.prototype.getGuestKey=function(t){return l(t),this.guestKeys[t]?new u({boxPk:this.getGuestRecord(t).fromBase64()}):null},e.prototype.getGuestRecord=function(t){return l(t),this.guestKeys[t]?this.guestKeys[t].pk:null},e.prototype.backup=function(){var t,n,r,o;if(r={},this.getNumberOfGuests()>0){n=this.guestKeys;for(t in n)(o=n[t]).temp||(r[t]=o.pk)}return r[e.UNIQ_TAG]=this.commKey.strSecKey(),JSON.stringify(r)},e.prototype.selfDestruct=function(t){return l(t),this.storage.remove("guest_registry").then(function(e){return function(){return e.storage.remove("comm_key").then(function(){return e.storage.selfDestruct(t)})}}(this))},e}(),e.exports=s,window.__CRYPTO_DEBUG&&(window.KeyRing=s)},{config:2,crypto_storage:3,events:1,keys:8,nacl:12,utils:16}],8:[function(t,e,n){var r,o,i={}.hasOwnProperty;o=t("utils"),r=function(){function t(t){t&&o.extend(this,t)}return t.prototype.toString=function(){return JSON.stringify(this.constructor.keys2str(this))},t.fromString=function(t){return t?this.str2keys(JSON.parse(t.trimLines())):null},t.prototype.key2str=function(t){return t&&null!=this[t]?this[t].toBase64():null},t.prototype.strPubKey=function(){return this.boxPk.toBase64()},t.prototype.strSecKey=function(){return this.boxSk.toBase64()},t.prototype.equal=function(t){return this.strPubKey()===t.strPubKey()&&(null!=this.boxSk==(null!=t.boxSk)&&(null==this.boxSk||this.strSecKey()===t.strSecKey()))},t.keys2str=function(e){var n,r,o;r=new t;for(n in e)i.call(e,n)&&(o=e[n],r[n]=o.toBase64());return r},t.str2keys=function(e){var n,r,o;r=new t;for(n in e)i.call(e,n)&&(o=e[n],r[n]=o.fromBase64());return r},t}(),e.exports=r,window.__CRYPTO_DEBUG&&(window.Keys=r)},{utils:16}],9:[function(t,e,n){var r,o,i,s,u,c,a=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;r=t("config"),i=t("keyring"),u=t("nacl"),c=t("utils"),o=t("events").EventEmitter,s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,o),e.new=function(t,n){var r;return null==n&&(n=null),r=new e,r.identity=t,r.sessionKeys={},r.sessionTimeout={},i.new(r.identity,n).then(function(t){return r.keyRing=t,r})},e.fromSeed=function(t,e,n){return null==e&&(e=t),null==n&&(n=null),this.new(e,n,!1).then(function(e){return e.keyRing.commFromSeed(t).then(function(){return e})})},e.fromSecKey=function(t,e,n){return null==n&&(n=null),this.new(e,n,!1).then(function(e){return e.keyRing.commFromSecKey(t).then(function(){return e})})},e.fromBackup=function(t,e,n){return null==n&&(n=null),this.new(e,n,!1).then(function(n){return i.fromBackup(e,t).then(function(t){return n.keyRing=t,n})})},e.prototype.hpk=function(){return this.keyRing.hpk.toBase64()},e.prototype.getPubCommKey=function(){return this.keyRing.getPubCommKey()},e.prototype.timeToSessionExpiration=function(t){var e,n,o;return(o=this.sessionTimeout[t])?(n=Math.max(r.RELAY_SESSION_TIMEOUT-(Date.now()-o.startTime),0),e=this.keyRing.timeToGuestExpiration(t),Math.min(n,e)):0},e.prototype.createSessionKey=function(t,e){return null==e&&(e=!1),c.ensure(t),!e&&this.sessionKeys[t]?c.resolve(this.sessionKeys[t]):(this.sessionTimeout[t]&&clearTimeout(this.sessionTimeout[t].timeoutId),u.makeKeyPair().then(function(e){return function(n){return e.sessionKeys[t]=n,e.sessionTimeout[t]={timeoutId:c.delay(r.RELAY_SESSION_TIMEOUT,function(){return e._clearSession(t)}),startTime:Date.now()},n}}(this)))},e.prototype._clearSession=function(t){return this.sessionKeys[t]=null,delete this.sessionKeys[t],this.sessionTimeout[t]=null,delete this.sessionTimeout[t],this.emit("relaysessiontimeout",t)},e.prototype.isConnectedToRelay=function(t){var e;return c.ensure(t),e=t.relayId(),Boolean(this.sessionKeys[e])&&Boolean(this._gPk(e))},e.prototype.rawEncodeMessage=function(t,n,r,o){return null==o&&(o=null),c.ensure(t,n,r),e._makeNonce(o).then(function(e){return function(o){return e._parseData(t).then(function(t){return u.use().crypto_box(t,o,n,r).then(function(t){return{nonce:o.toBase64(),ctext:t.toBase64()}})})}}(this))},e.prototype.rawDecodeMessage=function(t,e,n,r){return c.ensure(t,e,n,r),u.use().crypto_box_open(e,t,n,r).then(function(t){return u.use().decode_utf8(t).then(function(t){return JSON.parse(t)})})},e.prototype.encodeMessage=function(t,e,n,r){var o,i;if(null==n&&(n=!1),null==r&&(r=null),c.ensure(t,e),!(o=this._gPk(t)))throw new Error("encodeMessage: don't know guest "+t);return i=this._getSecretKey(t,n,r),this.rawEncodeMessage(e,o,i)},e.prototype.encodeMessageSymmetric=function(t,n){return c.ensure(t,n),e._makeNonce().then(function(e){return u.use().encode_latin1(t).then(function(t){return u.use().crypto_secretbox(t,e,n).then(function(t){return{nonce:e.toBase64(),ctext:t.toBase64()}})})})},e.prototype.decodeMessage=function(t,e,n,r,o){var i,s;if(null==r&&(r=!1),null==o&&(o=null),c.ensure(t,e,n),!(i=this._gPk(t)))throw new Error("decodeMessage: don't know guest "+t);return s=this._getSecretKey(t,r,o),this.rawDecodeMessage(e.fromBase64(),n.fromBase64(),i,s)},e.prototype.decodeMessageSymmetric=function(t,e,n){return c.ensure(t,e,n),u.use().crypto_secretbox_open(e.fromBase64(),t.fromBase64(),n.fromBase64()).then(function(t){return u.use().decode_latin1(t)})},e.prototype.connectToRelay=function(t){return c.ensure(t),t.openConnection().then(function(e){return function(){return t.connectMailbox(e)}}(this))},e.prototype.sendToVia=function(t,e,n){return c.ensure(t,e,n),this.connectToRelay(e).then(function(r){return function(){return r.relaySend(t,n,e)}}(this))},e.prototype.getRelayMessages=function(t){return c.ensure(t),this.connectToRelay(t).then(function(e){return function(){return e.relayMessages(t)}}(this))},e.prototype.relayCount=function(t){return c.ensure(t),t.count(this).then(function(t){return parseInt(t)})},e.prototype.relay_msg_status=function(t,e){return c.ensure(t),t.messageStatus(this,e).then(function(t){return t})},e.prototype.relaySend=function(t,e,n){return c.ensure(n),this.encodeMessage(t,e).then(function(e){return function(r){return u.h2(e._gPk(t)).then(function(t){return n.upload(e,t,r)})}}(this))},e.prototype.relayMessages=function(t){return c.ensure(t),t.download(this).then(function(t){return function(e){return c.all(e.map(function(e){var n;return(n=t.keyRing.tagByHpk(e.from))?(e.fromTag=n,"file"===e.kind?(e=JSON.parse(e.data),t.decodeMessage(n,e.nonce,e.ctext).then(function(t){return t.uploadID=e.uploadID,t})):t.decodeMessage(n,e.nonce,e.data).then(function(t){return t&&(e.msg=t,delete e.data),e})):e}))}}(this))},e.prototype.relayNonceList=function(t){return c.ensure(t),t.map(function(t){return t.nonce})},e.prototype.relayDelete=function(t,e){return c.ensure(t,e),e.delete(this,t)},e.prototype.clean=function(t){return c.ensure(t),this.getRelayMessages(t).then(function(e){return function(n){return e.relayDelete(e.relayNonceList(n),t)}}(this))},e.prototype.selfDestruct=function(t){return c.ensure(t),this.keyRing.selfDestruct(t)},e.prototype.getFileMetadata=function(t,e){return c.ensure(t,e),this.relayMessages(t).then(function(t){return(t=t.filter(function(t){return t.uploadID===e}))[0]})},e.prototype.startFileUpload=function(t,e,n){return c.ensure(e,t,n),u.h2(this._gPk(t)).then(function(r){return function(o){return u.makeSecretKey().then(function(i){return n.skey=i.key.toBase64(),r.encodeMessage(t,n).then(function(t){return r.connectToRelay(e).then(function(){var s;return s=n.orig_size,e.startFileUpload(r,o,s,t).then(function(t){return t.skey=i.key,t})})})})}}(this))},e.prototype.uploadFileChunk=function(t,e,n,r,o,i){return c.ensure(t,e,n,o,i),this.encodeMessageSymmetric(n,i).then(function(n){return function(i){return n.connectToRelay(t).then(function(){return t.uploadFileChunk(n,e,r,o,i)})}}(this))},e.prototype.getFileStatus=function(t,e){return c.ensure(t,e),this.connectToRelay(t).then(function(n){return function(){return t.fileStatus(n,e)}}(this))},e.prototype.downloadFileChunk=function(t,e,n,r){return c.ensure(t,e,r),this.connectToRelay(t).then(function(o){return function(){return t.downloadFileChunk(o,e,n).then(function(t){return o.decodeMessageSymmetric(t.nonce,t.ctext,r)})}}(this))},e.prototype.deleteFile=function(t,e){return c.ensure(t,e),this.connectToRelay(t).then(function(n){return function(){return t.deleteFile(n,e)}}(this))},e.prototype._gKey=function(t){return c.ensure(t),this.keyRing.getGuestKey(t)},e.prototype._gPk=function(t){var e;return c.ensure(t),null!=(e=this._gKey(t))?e.boxPk:void 0},e.prototype._gHpk=function(t){return c.ensure(t),u.h2(this._gPk(t))},e.prototype._getSecretKey=function(t,e,n){return n?this._gPk(n):e?this.sessionKeys[t].boxSk:this.keyRing.commKey.boxSk},e.prototype._parseData=function(t){return"Uint8Array"===c.type(t)?c.resolve(t):u.use().encode_utf8(JSON.stringify(t))},e._makeNonce=function(t,e){return null==t&&(t=null),null==e&&(e=Date.now()),u.use().crypto_box_random_nonce().then(function(n){var r,o,i,s,u,a,l,h,f,p;if(null==n||24!==n.length)throw new Error("RNG failed, try again?");for(i=8,o=c.itoa(parseInt(e/1e3)),t&&(r=c.itoa(t),i+=4),s=u=0,h=i;0<=h?u<h:u>h;s=0<=h?++u:--u)n[s]=0;for(s=a=0,f=o.length-1;0<=f?a<=f:a>=f;s=0<=f?++a:--a)n[8-o.length+s]=o[s];if(t)for(s=l=0,p=r.length-1;0<=p?l<=p:l>=p;s=0<=p?++l:--l)n[12-r.length+s]=r[s];return n})},e._nonceData=function(t){return c.atoi(t.subarray(8,12))},e}(),e.exports=s,window.__CRYPTO_DEBUG&&(window.MailBox=s)},{config:2,events:1,keyring:7,nacl:12,utils:16}],10:[function(t,e,n){e.exports={Utils:t("utils"),Mixins:t("mixins"),Nacl:t("nacl"),Keys:t("keys"),SimpleStorageDriver:t("test_driver"),CryptoStorage:t("crypto_storage"),KeyRing:t("keyring"),MailBox:t("mailbox"),Relay:t("relay"),RachetBox:t("rachetbox"),Config:t("config"),JsNaclDriver:t("js_nacl_driver"),JsNaclWebWorkerDriver:t("js_nacl_worker_driver"),setNaclImpl:function(t){return this.Nacl.setNaclImpl(t)},setPromiseImpl:function(t){return this.Utils.setPromiseImpl(t)},startStorageSystem:function(t){return this.CryptoStorage.startStorageSystem(t)},setAjaxImpl:function(t){return this.Utils.setAjaxImpl(t)}},window&&(window.glow=e.exports)},{config:2,crypto_storage:3,js_nacl_driver:4,js_nacl_worker_driver:5,keyring:7,keys:8,mailbox:9,mixins:11,nacl:12,rachetbox:13,relay:14,test_driver:15,utils:16}],11:[function(t,e,n){var r,o,i,s,u;for((o=t("utils")).include(String,{toCodeArray:function(){var t,e,n,r,o;for(r=[],t=0,e=(n=this).length;t<e;t++)o=n[t],r.push(o.charCodeAt());return r},toUTF8:function(){return unescape(encodeURIComponent(this))},fromUTF8:function(){return decodeURIComponent(escape(this))},toUint8Array:function(){return new Uint8Array(this.toUTF8().toCodeArray())},toUint8ArrayRaw:function(){return new Uint8Array(this.toCodeArray())},fromBase64:function(){return new Uint8Array(atob(this).toCodeArray())},trimLines:function(){return this.replace("\r\n","").replace("\n","").replace("\r","")}}),i=0,s=(u=[Array,Uint8Array,Uint16Array]).length;i<s;i++)r=u[i],o.include(r,{fromCharCodes:function(){var t;return function(){var e,n,r,o;for(o=[],e=0,n=(r=this).length;e<n;e++)t=r[e],o.push(String.fromCharCode(t));return o}.call(this).join("")},toBase64:function(){return btoa(this.fromCharCodes())},xorWith:function(t){var e,n;return this.length!==t.length?null:new Uint8Array(function(){var r,o,i,s;for(s=[],n=r=0,o=(i=this).length;r<o;n=++r)e=i[n],s.push(e^t[n]);return s}.call(this))},equal:function(t){var e,n,r,o;if(this.length!==t.length)return!1;for(e=n=0,r=(o=this).length;n<r;e=++n)if(o[e]!==t[e])return!1;return!0},sample:function(){return this.length>0?this[Math.floor(Math.random()*this.length)]:null}});o.include(Uint8Array,{concat:function(t){var e;return(e=new Uint8Array(this.byteLength+t.byteLength)).set(new Uint8Array(this),0),e.set(t,this.byteLength),e},fillWith:function(t){var e,n,r,o;for(e=n=0,r=(o=this).length;n<r;e=++n)o[e],this[e]=t;return this}}),e.exports={}},{utils:16}],12:[function(t,e,n){var r,o,i,s;o=t("keys"),s=t("utils"),t("config"),r=t("js_nacl_driver"),i=function(){function t(){}return t.API=["crypto_secretbox_random_nonce","crypto_secretbox","crypto_secretbox_open","crypto_box","crypto_box_open","crypto_box_random_nonce","crypto_box_keypair","crypto_box_keypair_from_raw_sk","crypto_box_seed_keypair","crypto_box_keypair_from_seed","crypto_hash_sha256","random_bytes","encode_latin1","decode_latin1","encode_utf8","decode_utf8","to_hex","from_hex"],t.prototype.naclImpl=null,t.setNaclImpl=function(t){return this.naclImpl=t},t.use=function(){return this.naclImpl||this.setDefaultNaclImpl(),this.naclImpl},t.setDefaultNaclImpl=function(){return this.naclImpl=new r},t.makeSecretKey=function(){return this.use().random_bytes(this.use().crypto_secretbox_KEYBYTES).then(function(t){return new o({key:t})})},t.random=function(t){return null==t&&(t=32),this.use().random_bytes(t)},t.makeKeyPair=function(){return this.use().crypto_box_keypair().then(function(t){return new o(t)})},t.fromSecretKey=function(t){return this.use().crypto_box_keypair_from_raw_sk(t).then(function(t){return new o(t)})},t.fromSeed=function(t){return this.use().crypto_box_keypair_from_seed(t).then(function(t){return new o(t)})},t.sha256=function(t){return this.use().crypto_hash_sha256(t)},t.to_hex=function(t){return this.use().to_hex(t)},t.from_hex=function(t){return this.use().from_hex(t)},t.encode_latin1=function(t){return this.use().encode_latin1(t)},t.decode_latin1=function(t){return this.use().decode_latin1(t)},t.encode_utf8=function(t){return this.use().encode_utf8(t)},t.decode_utf8=function(t){return this.use().decode_utf8(t)},t.h2=function(t){var e;return"String"===s.type(t)&&(t=t.toUint8ArrayRaw()),(e=new Uint8Array(32+t.length)).fillWith(0),e.set(t,32),this.sha256(e).then(function(t){return function(e){return t.sha256(e)}}(this))},t.h2_64=function(e){return t.h2(e.fromBase64()).then(function(t){return t.toBase64()})},t}(),e.exports=i,window.__CRYPTO_DEBUG&&(window.Nacl=i)},{config:2,js_nacl_driver:4,keys:8,utils:16}],13:[function(t,e,n){var r,o,i,s,u,c,a=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;c=t("utils"),s=t("nacl"),o=t("keys"),t("keyring"),r=t("keyratchet"),i=t("mailbox"),u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,i),e.prototype._loadRatchets=function(t){return this._gHpk(t).then(function(e){return function(n){return n=n.toBase64(),r.new("local_"+n+"_for_"+e.hpk().toBase64(),e.keyRing,e.keyRing.commKey).then(function(o){return e.krLocal=o,r.new("guest_"+n+"_for_"+e.hpk().toBase64(),e.keyRing,e.keyRing.getGuestKey(t)).then(function(t){return e.krGuest=t})})}}(this))},e.prototype.relaySend=function(t,e,n){return c.ensure(t,e,n),this._loadRatchets(e).then(function(r){return function(){var o,i;return o={org_msg:n},n.got_key||(o.nextKey=r.krLocal.nextKey.strPubKey()),i=r.krGuest[n.got_key?"lastKey":"confirmedKey"].boxPk,r.rawEncodeMessage(o,i,r.krLocal.confirmedKey.boxSk).then(function(n){return s.h2(r._gPk(e)).then(function(e){return t.upload(r,e,n)})})}}(this))},e.prototype._tryKeypair=function(t,e,n,r){try{return this.rawDecodeMessage(t.fromBase64(),e.fromBase64(),n,r)}catch(t){return t,c.resolve(null)}},e.prototype.decodeMessage=function(t,n,r,o,i){return null==o&&(o=!1),null==i&&(i=null),o?e.__super__.decodeMessage.call(this,t,n,r,o,i):(c.ensure(t,n,r),this._loadRatchets(t).then(function(t){return function(){var e;return e=[[t.krGuest.confirmedKey.boxPk,t.krLocal.confirmedKey.boxSk],[t.krGuest.lastKey.boxPk,t.krLocal.lastKey.boxSk],[t.krGuest.confirmedKey.boxPk,t.krLocal.lastKey.boxSk],[t.krGuest.lastKey.boxPk,t.krLocal.confirmedKey.boxSk]],c.serial(e,function(e){return t._tryKeypair(n,r,e[0],e[1])}).then(function(t){return t||console.log("RatchetBox decryption failed: message from unknown guest or ratchet out of sync"),t})}}(this)))},e.prototype.relayMessages=function(){return e.__super__.relayMessages.call(this).then(function(t){return function(e){var n,r;return n=[],r=e.map(function(e){if(e.fromTag)return t._loadRatchets(e.fromTag).then(function(){var r,i,u;return(null!=(u=e.msg)?u.nextKey:void 0)&&(i=new o({boxPk:e.msg.nextKey.fromBase64()}),r=t.krGuest.confKey(i).then(function(t){if(t)return s.h2_64(e.msg.nextKey).then(function(t){return n.push({toTag:e.fromTag,key:e.msg.nextKey,msg:{got_key:t}})})})),(r||c.resolve()).then(function(){var n,r,o;return(null!=(r=e.msg)&&null!=(o=r.org_msg)?o.got_key:void 0)&&(e.msg=e.msg.org_msg,n=t.krLocal.isNextKeyHash(e.msg.got_key.fromBase64()).then(function(e){if(e)return s.makeKeyPair().then(function(e){return t.krLocal.pushKey(e)})}).then(function(){return e.msg=null})),(n||c.resolve()).then(function(){if(e.msg)return e.msg=e.msg.org_msg})})}),c.all(r).then(function(){return c.serial(n,function(e){return t.relaySend(e.toTag,e.msg).then(function(){return!1})})})})}}(this))},e.prototype.selfDestruct=function(t,n){if(null==n&&(n=!1),t)return n?c.all(this.keyRing.registry.map(function(t){return function(e){return t._loadRatchets(e).then(function(){return t.krLocal.selfDestruct(n).then(function(){return t.krGuest.selfDestruct(n)})})}}(this))).then(function(n){return function(){return e.__super__.selfDestruct.call(n,t)}}(this)):void 0},e}(),e.exports=u,window.__CRYPTO_DEBUG&&(window.RatchetBox=u)},{keyratchet:6,keyring:7,keys:8,mailbox:9,nacl:12,utils:16}],14:[function(t,e,n){var r,o,i,s,u,c,a=function(t,e){return function(){return t.apply(e,arguments)}},l=function(t,e){function n(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty,f=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},p=[].slice;r=t("config"),i=t("keys"),s=t("nacl"),c=t("utils"),o=t("events").EventEmitter,u=function(t){function e(t){this.url=null!=t?t:null,this._ajax=a(this._ajax,this),this.retriesCount=0,this.url&&localStorage&&(this.blockedTill=localStorage.getItem("blocked_"+this.url)||0),this._resetState(),this.RELAY_COMMANDS=["count","upload","download","messageStatus","delete","startFileUpload","uploadFileChunk","downloadFileChunk","fileStatus","deleteFile","getEntropy"]}return l(e,o),e.prototype.openConnection=function(){return this.getServerToken().then(function(t){return function(){return t.getServerKey()}}(this))},e.prototype.getServerToken=function(){var t;return c.ensure(this.url),this.clientToken||(t=s.random(r.RELAY_TOKEN_LEN).then(function(t){return function(e){return t.clientToken=e}}(this))),t=(t||c.resolve()).then(function(t){return function(){if(t.clientToken&&t.clientToken.length!==r.RELAY_TOKEN_LEN)throw new Error("Token must be "+r.RELAY_TOKEN_LEN+" bytes");return t.clientTokenExpiration&&clearTimeout(t.clientTokenExpiration),t._request("start_session",t.clientToken.toBase64()).then(function(e){var n;if(t._scheduleExpireSession(),n=t._processData(e),t.relayToken=n[0].fromBase64(),2!==n.length)throw new Error("Wrong start_session from "+t.url);return t.diff=parseInt(n[1]),t.diff>10&&console.log("Relay "+t.url+" requested difficulty "+t.diff+". Session handshake may take longer."),t.diff>16&&console.log("Attempting handshake at difficulty "+t.diff+"! This may take a while"),e})}}(this))},e.prototype.getServerKey=function(){return c.ensure(this.url,this.clientToken,this.relayToken),s.h2(this.clientToken).then(function(t){return function(e){var n,r;return t.h2ClientToken=e.toBase64(),r=t.clientToken.concat(t.relayToken),(0===t.diff?s.h2(r).then(function(t){return t.toBase64()}):(n=function(){return s.random(32).then(function(e){return s.h2(r.concat(e)).then(function(r){return c.arrayZeroBits(r,t.diff)?e:n()})})})().then(function(t){return t.toBase64()})).then(function(e){return t._request("verify_session",t.h2ClientToken,e).then(function(e){var n;return n=e.fromBase64(),t.relayKey=new i({boxPk:n}),t.online=!0,delete t.diff,e})})}}(this))},e.prototype.relayId=function(){return c.ensure(this.url),"relay_"+this.url},e.prototype.connectMailbox=function(t){var e;return c.ensure(t,this.online,this.relayKey,this.url),e=this.relayId(),t.createSessionKey(e,!0).then(function(n){return function(r){return n._request("prove",t,r.boxPk).then(function(t){return e})}}(this))},e.prototype.runCmd=function(t,e,n){var r;if(null==n&&(n=null),c.ensure(t,e),f.call(this.RELAY_COMMANDS,t)<0)throw new Error("Relay "+this.url+" doesn't support "+t);return r={cmd:t},n&&(r=c.extend(r,n)),this._request("command",e,r).then(function(r){return function(o){if(null==o)throw new Error(r.url+" - "+t+" error");return r._processResponse(o,e,t,n)}}(this)).catch(function(e){return function(n){throw new Error(e.url+" - "+t+" - "+n.message)}}(this))},e.prototype._request=function(t,e,n){var o,i,u,a,l,h;if(c.ensure(t,e),null!=this.blockedTill&&this.blockedTill>Date.now())throw new Error("Relay disabled till "+new Date(parseInt(this.blockedTill,10)));if(this.retriesCount>=r.RELAY_RETRY_REQUEST_ATTEMPTS)throw this.retriesCount=0,this.blockedTill=Date.now()+r.RELAY_BLOCKING_TIME,localStorage&&localStorage.setItem("blocked_"+this.url,this.blockedTill),new Error("Relay out of reach");switch(t){case"start_session":l=this._ajax("start_session",e);break;case"verify_session":l=this._ajax("verify_session",e,n);break;case"prove":o=n,(u=e).keyRing.addTempGuest(this.relayId(),this.relayKey.strPubKey()),delete this.relayKey,h=o.concat(this.relayToken).concat(this.clientToken),l=s.h2(h).then(function(t){return function(e){return u.encodeMessage(t.relayId(),e).then(function(e){return e.pub_key=u.keyRing.getPubCommKey(),u.encodeMessage(t.relayId(),e,!0).then(function(e){return t._ajax("prove",t.h2ClientToken,o.toBase64(),e.nonce,e.ctext)})})}}(this));break;case"command":"uploadFileChunk"===n.cmd?(i=n.ctext,delete(a=c.extend({},n)).ctext,l=e.encodeMessage(this.relayId(),a,!0).then(function(t){return function(n){return t._ajax("command",e.hpk(),n.nonce,n.ctext,i)}}(this))):l=e.encodeMessage(this.relayId(),n,!0).then(function(t){return function(n){return t._ajax("command",e.hpk(),n.nonce,n.ctext)}}(this));break;default:throw new Error("Unknown request type "+t)}return l.then(function(t){return function(e){return t.retriesCount=0,t.blockedTill=0,e}}(this)).catch(function(r){return function(o){var i,s;if(401!==(i=null!=(s=o.response)?s.status:void 0)&&500!==i)throw new Error("Bad Request");return r.retriesCount++,r._resetState(),"start_session"===t?r.getServerToken():"verify_session"===t?r.openConnection():"prove"===t?r.openConnection().then(function(){return r.connectMailbox(e)}):r.openConnection().then(function(){return r.connectMailbox(e).then(function(){return r._request(t,e,n)})})}}(this))},e.prototype._processResponse=function(t,e,n,o){var i,s,u;if(s=this._processData(String(t)),"delete"===n)return JSON.parse(t);if("upload"===n){if(1!==s.length||s[0].length!==r.RELAY_TOKEN_B64)throw new Error(this.url+" - "+n+": Bad response");return o.storage_token=t,o}if("messageStatus"===n){if(1!==s.length)throw new Error(this.url+" - "+n+": Bad response");return parseInt(s[0])}if("downloadFileChunk"===n){if(3!==s.length)throw new Error(this.url+" - "+n+": Bad response");return u=s[0],i=s[1],e.decodeMessage(this.relayId(),u,i,!0).then(function(t){return t=JSON.parse(t),t.ctext=s[2],t})}if(2!==s.length)throw new Error(this.url+" - "+n+": Bad response");return u=s[0],i=s[1],"startFileUpload"===n||"fileStatus"===n||"uploadFileChunk"===n||"deleteFile"===n?e.decodeMessage(this.relayId(),u,i,!0).then(function(t){return JSON.parse(t)}):e.decodeMessage(this.relayId(),u,i,!0)},e.prototype._processData=function(t){var e;return(e=t.split("\r\n")).length>=2||(e=t.split("\n")),e},e.prototype._ajax=function(){var t,e;return t=arguments[0],e=2<=arguments.length?p.call(arguments,1):[],c.ajax(this.url+"/"+t,e.join("\r\n"))},e.prototype.count=function(t){return this.runCmd("count",t)},e.prototype.upload=function(t,e,n){return this.runCmd("upload",t,{to:e.toBase64(),payload:n})},e.prototype.messageStatus=function(t,e){return this.runCmd("messageStatus",t,{token:e})},e.prototype.download=function(t){return this.runCmd("download",t)},e.prototype.delete=function(t,e){return this.runCmd("delete",t,{payload:e})},e.prototype.startFileUpload=function(t,e,n,r){return this.runCmd("startFileUpload",t,{to:e.toBase64(),file_size:n,metadata:r})},e.prototype.uploadFileChunk=function(t,e,n,r,o){return this.runCmd("uploadFileChunk",t,{uploadID:e,part:n,last_chunk:r-1===n,nonce:o.nonce,ctext:o.ctext})},e.prototype.fileStatus=function(t,e){return this.runCmd("fileStatus",t,{uploadID:e})},e.prototype.downloadFileChunk=function(t,e,n){return this.runCmd("downloadFileChunk",t,{uploadID:e,part:n})},e.prototype.deleteFile=function(t,e){return this.runCmd("deleteFile",t,{uploadID:e})},e.prototype._resetState=function(){return this.clientToken=null,this.online=!1,this.relayToken=null,this.relayKey=null,this.clientTokenExpiration=null,this.clientTokenExpirationStart=0},e.prototype.timeToTokenExpiration=function(){return Math.max(r.RELAY_TOKEN_TIMEOUT-(Date.now()-this.clientTokenExpirationStart),0)},e.prototype.timeToSessionExpiration=function(t){return t.timeToSessionExpiration(this.relayId())},e.prototype._scheduleExpireSession=function(){return this.clientTokenExpiration&&clearTimeout(this.clientTokenExpiration),this.clientTokenExpirationStart=Date.now(),this.clientTokenExpiration=setTimeout(function(t){return function(){return t._resetState(),t.emit("relaytokentimeout")}}(this),r.RELAY_TOKEN_TIMEOUT)},e}(),e.exports=u,window.__CRYPTO_DEBUG&&(window.Relay=u)},{config:2,events:1,keys:8,nacl:12,utils:16}],15:[function(t,e,n){var r,o;o=t("utils"),r=function(){function t(t,e){null==t&&(t="storage."),null==e&&(e=null),this._root_tag="__glow."+t,this._load(e)}return t.prototype._state=null,t.prototype._key_tag=function(t){return this._root_tag+"."+t},t.prototype.get=function(t){var e;return this._state||this._load(),e=this._state[t]?this._state[t]:JSON.parse(localStorage.getItem(this._key_tag(t))),o.resolve(e)},t.prototype.set=function(t,e){return this._state||this._load(),this._state[t]=e,localStorage.setItem(this._key_tag(t),JSON.stringify(e)),this._persist()},t.prototype.multiSet=function(t){var e,n,r,o;for(this._state||this._load(),e=n=0,o=t.length;n<o;e=n+=2)r=t[e],localStorage.setItem(this._key_tag(r),JSON.stringify(t[e+1]));return this._persist()},t.prototype.remove=function(t){return this._state||this._load(),delete this._state[t],localStorage.removeItem(this._key_tag(t)),this._persist()},t.prototype._persist=function(){return o.resolve()},t.prototype._load=function(t){return null==t&&(t=null),this._state=t||{},console.log("INFO: SimpleTestDriver uses localStorage and should not be used in production for permanent key storage.")},t}(),e.exports=r},{utils:16}],16:[function(t,e,n){var r,o;r=t("config"),o=function(){function t(){}return t.extend=function(t,e){var n;if("undefined"!=typeof $&&null!==$?$.extend:void 0)return $.extend(t,e);for(n in e)e[n],void 0!==e[n]&&(t[n]=e[n]);return t},t.include=function(t,e){return this.extend(t.prototype,e)},t.type=function(t){return void 0===t?"undefined":null===t?"null":Object.prototype.toString.call(t).replace("[","").replace("]","").split(" ")[1]},t.ajaxImpl=null,t.setAjaxImpl=function(t){return this.ajaxImpl=t},t.ajax=function(t,e){return this.ajaxImpl||this.setDefaultAjaxImpl(),this.ajaxImpl(t,e)},t.setDefaultAjaxImpl=function(){if("undefined"!=typeof axios&&null!==axios)return this.setAjaxImpl(function(t,e){return axios({url:t,method:"post",headers:{Accept:"text/plain","Content-Type":"text/plain"},data:e,responseType:"text",timeout:r.RELAY_AJAX_TIMEOUT}).then(function(t){return t.data})});if(("undefined"!=typeof $&&null!==$?$.ajax:void 0)&&("undefined"!=typeof $&&null!==$?$.Deferred:void 0))return this.setAjaxImpl(function(t,e){return $.ajax({url:t,type:"POST",dataType:"text",timeout:r.RELAY_AJAX_TIMEOUT,context:this,error:console.log,contentType:"text/plain",data:e})});throw new Error("Unable to set default Ajax implementation.")},t.promiseImpl=null,t.setPromiseImpl=function(t){return this.promiseImpl=t},t.getPromiseImpl=function(){return this.promiseImpl||this.setDefaultPromiseImpl(),this.promiseImpl},t.setDefaultPromiseImpl=function(){if("undefined"!=typeof Promise&&null!==Promise)return this.setPromiseImpl({promise:function(t){return new Promise(t)},all:function(t){return Promise.all(t)}});throw new Error("Unable to set default Promise implementation.")},t.delay=function(t,e){return setTimeout(e,t)},t.itoa=function(t){var e,n,r,o,i,s;return t<=0?new Uint8Array(function(){var t,e;for(e=[],n=t=0;t<=7;n=++t)e.push(0);return e}()):(i=[Math.floor,Math.pow,Math.log],e=i[0],o=i[1],r=i[2],s=e(r(t)/r(256)),new Uint8Array(function(){var r,i,u;for(u=[],n=r=i=s;i<=0?r<=0:r>=0;n=i<=0?++r:--r)u.push(e(t/o(256,n))%256);return u}()))},t.atoi=function(t){var e,n,r,o,i;for(r=t.length-1,i=0,e=n=0,o=t.length;n<o;e=++n)i+=t[e]*Math.pow(256,r-e);return i},t.firstZeroBits=function(t,e){return t===t>>e<<e},t.arrayZeroBits=function(t,e){var n,r,o,i,s;for(s=e,r=o=0,i=1+e/8;0<=i?o<=i:o>=i;r=0<=i?++o:--o){if(n=t[r],s<=0)return!0;if(!(s>8))return this.firstZeroBits(n,s);if(s-=8,n>0)return!1}return!1},t.resolve=function(t){return this.getPromiseImpl().promise(function(e,n){return e(t)})},t.reject=function(t){return this.getPromiseImpl().promise(function(e,n){return n(t)})},t.promise=function(t){return this.getPromiseImpl().promise(t)},t.all=function(t){return this.getPromiseImpl().all(t)},t.serial=function(t,e){var n,r;return n=0,(r=function(o){return e(o).then(function(e){return e||(n<t.length?r(t[++n]):void 0)})})(t[++n])},t.ENSURE_ERROR_MSG="invalid arguments",t.ensure=function(){var e,n,r;for(r=[],e=0,n=arguments.length;e<n;e++){if(!arguments[e])throw new Error(t.ENSURE_ERROR_MSG);r.push(void 0)}return r},t}(),e.exports=o,window.__CRYPTO_DEBUG&&(window.Utils=o)},{config:2}]},{},[10]);